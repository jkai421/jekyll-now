---
layout: post
title: Cocos2d-x中的物理碰撞
---

##刚体
在物理引擎中参与碰撞检测的单位称为**刚体**。在Cocos2d-x中使用setPhysicsBody(PhysicsBody* body)
方法来将一个Node子类实例设置为刚体。
    class CC_DLL Node:publi Ref
    {
    public:
        void setPhysicsBody(PhysicsBody* body);
        PhysicsBody* getPhysicsBody() const;
    }
    
##接触
游戏中的物体在移动过程中，需要知道它们是否**接触**了，进而判断他们是否应该发生**碰撞**。
**接触**是指当刚体在几何形状发生重合的过程中，物理引擎通知应用程序的一系列回调，包括开始接触、
碰撞前、碰撞后、接触结束四个状态。
**碰撞**用来处理接触的物体之间的刚体动力学模拟，阻止两个刚体互相贯穿，Chipmunk自动计算两个物体的
碰撞结果。

##刚体的三种掩码
1. 类别掩码，这是刚体的身份标记，用来对刚体在游戏中所代表的类别进行标记。类别掩码分别与其它刚体的
接触掩码和碰撞掩码进行**逻辑与**操作，可以判断两个刚体是否发生**接触**、是否发生**碰撞**

2. 接触掩码，与其它刚体的类别掩码**逻辑与**来对接触进行过滤。结果为true时，触发**接触回调函数**。

3. 碰撞掩码，与其它刚体的类别掩码**逻辑与**来对碰撞进行过滤。

##接触回调
在Cocos2d-x中，可以通过注册一个订阅者EventListenerPysicsContact来实现碰撞处理。

这个事件由4个回调函数组成，分别表示接触过程中的4个阶段：

1. onContactBegin：两个形状开始接触时触发，返回true则继续调用2、3两个处理函数，否则跳过2、3
直接执行接触分离回调函数4。一次接触过程中只触发一次

2. onConPreSolve：接触过程中每帧都会触发，发生在碰撞的物理模拟之前，如果返回true，则进行碰撞
模拟。

3. onContactPostSolve：接触过程中每帧都会触发，发生在碰撞的物理模拟之后，可以使用模拟的结果进行
效果处理。

4. onContactSeparate：发生在接触过程结束之后，与onContactBegin总是成对出现。
